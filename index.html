<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caducée - Assistant de Pré-Analyse Médicale</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Poppins:wght@300;400;600&display=swap');
        :root {
            --font-title: 'Lora', serif; --font-body: 'Poppins', sans-serif;
            --color-primary: #2980b9; --color-secondary: #27ae60;
            --color-text: #34495e; --color-bg: #ecf0f1;
            --color-warning: #c0392b;
        }
        body, html { margin: 0; font-family: var(--font-body); background-color: var(--color-bg); color: var(--color-text); }
        .container { max-width: 800px; margin: 40px auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-family: var(--font-title); font-size: 3em; margin: 0; }
        .header p { font-size: 1.1em; color: #7f8c8d; }
        .symptom-form { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        textarea { width: 100%; min-height: 120px; padding: 15px; border-radius: 5px; border: 1px solid #bdc3c7; font-size: 1em; font-family: var(--font-body); resize: vertical; box-sizing: border-box; }
        .submit-btn { display: block; width: 100%; padding: 15px; border: none; background-color: var(--color-primary); color: white; border-radius: 5px; font-size: 1.2em; font-weight: 600; cursor: pointer; margin-top: 20px; }
        .submit-btn:disabled { background-color: #bdc3c7; }
        .results-container { margin-top: 40px; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: none; }
        .results-container h2 { font-family: var(--font-title); }
        .diagnosis-card { border: 1px solid #ecf0f1; border-radius: 5px; padding: 15px; margin-bottom: 10px; }
        .urgency-level { padding: 15px; border-radius: 5px; font-weight: 600; text-align: center; margin-top: 20px; }
        .urgency-low { background-color: #dff9fb; color: #008299; }
        .urgency-moderate { background-color: #fffbe6; color: #f39c12; }
        .urgency-high { background-color: #fbeae8; color: var(--color-warning); }
        .final-warning { margin-top: 20px; padding: 15px; background-color: #fbeae8; color: var(--color-warning); border: 1px solid var(--color-warning); border-radius: 5px; text-align: center; font-weight: 500; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Caducée IA</h1>
            <p>Décrivez vos symptômes, obtenez une pré-analyse instantanée.</p>
        </header>

        <section class="symptom-form">
            <form id="symptom-form">
                <textarea id="symptoms-input" placeholder="Ex: J'ai mal à la tête, de la fièvre depuis 2 jours, et je tousse beaucoup..."></textarea>
                <button type="submit" id="submit-button" class="submit-btn">Analyser mes symptômes</button>
            </form>
        </section>

        <section class="results-container" id="results-container">
            <h2>Pré-analyse de vos symptômes</h2>
            <div id="diagnosis-list"></div>
            <div id="urgency-level" class="urgency-level"></div>
            <div id="final-warning" class="final-warning"></div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const symptomForm = document.getElementById('symptom-form');
            const symptomsInput = document.getElementById('symptoms-input');
            const submitButton = document.getElementById('submit-button');
            const resultsContainer = document.getElementById('results-container');
            const diagnosisList = document.getElementById('diagnosis-list');
            const urgencyLevelDiv = document.getElementById('urgency-level');
            const finalWarningDiv = document.getElementById('final-warning');
            
            // Pour le test, nous allons utiliser une API simulée.
            // Remplacez cette URL par l'URL de votre API Render.
            const API_BASE_URL = 'https://caducee-api.onrender.com';
            // Pour le test, nous utiliserons un token simulé.
            // Dans une vraie application, l'utilisateur devrait se connecter.
            const FAKE_TOKEN = 'fake-token-for-testing';

            symptomForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                const symptoms = symptomsInput.value.trim();
                if (!symptoms) {
                    alert('Veuillez décrire vos symptômes.');
                    return;
                }

                submitButton.textContent = 'Analyse en cours...';
                submitButton.disabled = true;
                resultsContainer.style.display = 'none';

                try {
                    const response = await fetch(`${API_BASE_URL}/analysis`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${FAKE_TOKEN}`
                        },
                        body: JSON.stringify({ symptoms: symptoms })
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.detail || 'Erreur du serveur');
                    }
                    
                    const data = await response.json();
                    displayResults(data);

                } catch (error) {
                    alert(`Erreur : ${error.message}`);
                } finally {
                    submitButton.textContent = 'Analyser mes symptômes';
                    submitButton.disabled = false;
                }
            });

            function displayResults(data) {
                diagnosisList.innerHTML = '';
                data.differential_diagnosis.forEach(diag => {
                    const card = document.createElement('div');
                    card.className = 'diagnosis-card';
                    card.innerHTML = `
                        <strong>${diag.condition}</strong><br>
                        Probabilité : ${diag.probability}<br>
                        Spécialiste : ${diag.specialist}
                    `;
                    diagnosisList.appendChild(card);
                });

                urgencyLevelDiv.textContent = `Niveau d'urgence : ${data.urgency_level}`;
                if (data.urgency_level.includes('Élevée')) {
                    urgencyLevelDiv.className = 'urgency-level urgency-high';
                } else if (data.urgency_level.includes('Modérée')) {
                    urgencyLevelDiv.className = 'urgency-level urgency-moderate';
                } else {
                    urgencyLevelDiv.className = 'urgency-level urgency-low';
                }

                finalWarningDiv.textContent = data.warning;
                resultsContainer.style.display = 'block';
            }
        });
    </script>
</body>
</html>